{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gamin\\\\OneDrive\\\\Desktop\\\\Project\\\\Whiteboard\\\\live-whiteboard-app\\\\whiteboard-frontend\\\\src\\\\components\\\\WhiteboardRoom.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// whiteboard-frontend/src/components/WhiteboardRoom.js\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Stage, Layer, Line, Rect, Circle, Text, Transformer } from 'react-konva';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport './WhiteboardRoom.css'; // Make sure this CSS file is updated too!\n\n// IMPORTANT: Make sure YOUR_PC_IP_ADDRESS is replaced with your actual PC's IP.\n// Consider using an environment variable for deployment (e.g., process.env.REACT_APP_BACKEND_URL)\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst socket = io('http://192.168.1.102:5000');\n\n// Helper component for selectable/transformable Konva nodes (unchanged, as touch-action is on Stage)\nconst ColoredRect = ({\n  shapeProps,\n  isSelected,\n  onSelect,\n  onChange,\n  activeTool\n}) => {\n  _s();\n  const shapeRef = useRef();\n  const trRef = useRef();\n  useEffect(() => {\n    if (isSelected && trRef.current && shapeRef.current) {\n      trRef.current.nodes([shapeRef.current]);\n      trRef.current.getLayer().batchDraw();\n    } else if (!isSelected && trRef.current) {\n      trRef.current.nodes([]);\n      trRef.current.getLayer().batchDraw();\n    }\n  }, [isSelected, shapeProps.type]);\n  const handleDblClick = e => {\n    onSelect();\n    if (shapeProps.type === 'text') {\n      setTimeout(() => {\n        if (trRef.current) {\n          trRef.current.nodes([]);\n          trRef.current.getLayer().batchDraw();\n        }\n        const textNode = shapeRef.current;\n        if (!textNode) return;\n        textNode.hide();\n        textNode.getLayer().batchDraw();\n        const textPosition = textNode.absolutePosition();\n        const stageBox = textNode.getStage().container().getBoundingClientRect();\n        const textarea = document.createElement('textarea');\n        document.body.appendChild(textarea);\n        textarea.value = textNode.text();\n        textarea.style.position = 'absolute';\n        textarea.style.top = textPosition.y + stageBox.top + 'px';\n        textarea.style.left = textPosition.x + stageBox.left + 'px';\n        textarea.style.width = textNode.width() - textNode.padding() * 2 + 'px';\n        textarea.style.height = textNode.height() - textNode.padding() * 2 + 5 + 'px';\n        textarea.style.fontSize = textNode.fontSize() + 'px';\n        textarea.style.border = 'none';\n        textarea.style.padding = '0px';\n        textarea.style.margin = '0px';\n        textarea.style.overflow = 'hidden';\n        textarea.style.background = 'none';\n        textarea.style.outline = 'none';\n        textarea.style.resize = 'none';\n        textarea.style.lineHeight = textNode.lineHeight();\n        textarea.style.fontFamily = textNode.fontFamily();\n        textarea.style.transformOrigin = 'left top';\n        textarea.style.textAlign = textNode.align();\n        textarea.style.color = textNode.fill();\n        textarea.style.transform = `rotateZ(${textNode.rotation()}deg)`;\n        textarea.style.zIndex = '9999';\n        textarea.focus();\n        const removeTextarea = () => {\n          document.body.removeChild(textarea);\n          textNode.show();\n          textNode.getLayer().batchDraw();\n        };\n        textarea.addEventListener('keydown', e => {\n          if (e.key === 'Enter' && !e.shiftKey) {\n            textarea.blur();\n          }\n          if (e.key === 'Escape') {\n            removeTextarea();\n          }\n        });\n        textarea.addEventListener('blur', () => {\n          onChange({\n            ...shapeProps,\n            text: textarea.value\n          });\n          removeTextarea();\n        });\n      }, 0);\n    }\n  };\n  const currentKonvaNode = shapeProps.type === 'rect' ? /*#__PURE__*/_jsxDEV(Rect, {\n    onClick: onSelect,\n    onTap: onSelect,\n    onDblClick: handleDblClick,\n    onDblTap: handleDblClick,\n    ref: shapeRef,\n    ...shapeProps,\n    draggable: activeTool === 'select',\n    onDragEnd: e => {\n      onChange({\n        ...shapeProps,\n        x: e.target.x(),\n        y: e.target.y()\n      });\n    },\n    onTransformEnd: e => {\n      const node = shapeRef.current;\n      const scaleX = node.scaleX();\n      const scaleY = node.scaleY();\n      node.scaleX(1);\n      node.scaleY(1);\n      onChange({\n        ...shapeProps,\n        x: node.x(),\n        y: node.y(),\n        width: Math.max(5, node.width() * scaleX),\n        height: Math.max(5, node.height() * scaleY),\n        rotation: node.rotation()\n      });\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 7\n  }, this) : shapeProps.type === 'circle' ? /*#__PURE__*/_jsxDEV(Circle, {\n    onClick: onSelect,\n    onTap: onSelect,\n    onDblClick: handleDblClick,\n    onDblTap: handleDblClick,\n    ref: shapeRef,\n    ...shapeProps,\n    draggable: activeTool === 'select',\n    onDragEnd: e => {\n      onChange({\n        ...shapeProps,\n        x: e.target.x(),\n        y: e.target.y()\n      });\n    },\n    onTransformEnd: e => {\n      const node = shapeRef.current;\n      const scaleX = node.scaleX();\n      node.scaleX(1);\n      node.scaleY(1);\n      onChange({\n        ...shapeProps,\n        x: node.x(),\n        y: node.y(),\n        radius: Math.max(5, node.radius() * scaleX),\n        rotation: node.rotation()\n      });\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 7\n  }, this) : shapeProps.type === 'text' ? /*#__PURE__*/_jsxDEV(Text, {\n    onClick: onSelect,\n    onTap: onSelect,\n    onDblClick: handleDblClick,\n    onDblTap: handleDblClick,\n    ref: shapeRef,\n    ...shapeProps,\n    draggable: activeTool === 'select',\n    onDragEnd: e => {\n      onChange({\n        ...shapeProps,\n        x: e.target.x(),\n        y: e.target.y()\n      });\n    },\n    onTransformEnd: e => {\n      const node = shapeRef.current;\n      const scaleX = node.scaleX();\n      const scaleY = node.scaleY();\n      node.scaleX(1);\n      node.scaleY(1);\n      onChange({\n        ...shapeProps,\n        x: node.x(),\n        y: node.y(),\n        width: Math.max(5, node.width() * scaleX),\n        height: Math.max(5, node.height() * scaleY),\n        fontSize: Math.max(8, node.fontSize() * scaleX),\n        rotation: node.rotation()\n      });\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 7\n  }, this) : null;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [currentKonvaNode, isSelected && currentKonvaNode && /*#__PURE__*/_jsxDEV(Transformer, {\n      ref: trRef,\n      boundBoxFunc: (oldBox, newBox) => {\n        if (newBox.width < 5 || newBox.height < 5) {\n          return oldBox;\n        }\n        return newBox;\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n_s(ColoredRect, \"utqYnE1qYQB2JA/ZIFXzHjUZTOc=\");\n_c = ColoredRect;\nfunction WhiteboardRoom() {\n  _s2();\n  const {\n    roomName\n  } = useParams();\n  const navigate = useNavigate();\n  const [drawingObjects, setDrawingObjects] = useState([]);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const stageRef = useRef(null);\n  const currentObjectId = useRef(null);\n  const [chatMessages, setChatMessages] = useState([]);\n  const [newChatMessage, setNewChatMessage] = useState('');\n  const chatMessagesEndRef = useRef(null);\n  const [stageDimensions, setStageDimensions] = useState({\n    width: window.innerWidth * 0.7,\n    height: window.innerHeight * 0.8\n  });\n  const canvasContainerRef = useRef(null);\n\n  // --- BRUSH STATE VARIABLES ---\n  const [tool, setTool] = useState('pen'); // 'pen', 'marker', 'dashed', 'calligraphy', 'eraser', 'rect', 'circle', 'text', 'select'\n  const [strokeColor, setStrokeColor] = useState('#000000');\n  const [strokeWidth, setStrokeWidth] = useState(5);\n  const [fillColor, setFillColor] = useState('transparent');\n  const [selectedId, selectShape] = useState(null);\n\n  // Brush specific properties\n  const [brushOpacity, setBrushOpacity] = useState(1.0); // 0.0 to 1.0\n  const [lineCap, setLineCap] = useState('round'); // 'butt', 'round', 'square'\n  const [isDashed, setIsDashed] = useState(false); // Whether the line should be dashed (now controlled by tool directly)\n\n  useEffect(() => {\n    if (!roomName) {\n      navigate('/');\n      return;\n    }\n    socket.emit('joinRoom', roomName);\n    socket.on('connect', () => {\n      console.log('Connected to backend Socket.IO:', socket.id);\n    });\n    socket.on('disconnect', () => {\n      console.log('Disconnected from backend Socket.IO');\n      alert('Disconnected from server. Please refresh.');\n      navigate('/');\n    });\n    socket.on('whiteboardState', data => {\n      console.log('Received initial room state:', data);\n      setDrawingObjects(data.lines);\n      setChatMessages(data.messages);\n    });\n    socket.on('drawingStarted', newObject => {\n      setDrawingObjects(prevObjects => [...prevObjects, newObject]);\n    });\n    socket.on('drawing', data => {\n      const {\n        objectId,\n        newPoints\n      } = data;\n      setDrawingObjects(prevObjects => {\n        return prevObjects.map(obj => {\n          if (obj.id === objectId && obj.type === 'line') {\n            return {\n              ...obj,\n              points: obj.points.concat(newPoints)\n            };\n          }\n          return obj;\n        });\n      });\n    });\n    socket.on('drawingFinished', data => {\n      const {\n        objectId,\n        finalObjectState\n      } = data;\n      setDrawingObjects(prevObjects => {\n        return prevObjects.map(obj => {\n          if (obj.id === objectId) {\n            return finalObjectState;\n          }\n          return obj;\n        });\n      });\n    });\n    socket.on('objectUpdated', data => {\n      const {\n        objectId,\n        newAttributes\n      } = data;\n      setDrawingObjects(prevObjects => {\n        return prevObjects.map(obj => {\n          if (obj.id === objectId) {\n            return {\n              ...obj,\n              ...newAttributes\n            };\n          }\n          return obj;\n        });\n      });\n    });\n    socket.on('whiteboardCleared', () => {\n      setDrawingObjects([]);\n      selectShape(null);\n      console.log('Whiteboard cleared by another user.');\n    });\n    socket.on('chatMessage', message => {\n      setChatMessages(prevMessages => [...prevMessages, message]);\n    });\n    socket.on('userJoined', username => {\n      setChatMessages(prevMessages => [...prevMessages, {\n        username: 'System',\n        message: `${username} has joined the room.`,\n        timestamp: new Date()\n      }]);\n    });\n    socket.on('roomDestroyed', destroyedRoomName => {\n      if (destroyedRoomName === roomName) {\n        alert(`Room \"${destroyedRoomName}\" has been closed or automatically destroyed.`);\n        navigate('/');\n      }\n    });\n    const handleResize = () => {\n      if (canvasContainerRef.current) {\n        const {\n          clientWidth,\n          clientHeight\n        } = canvasContainerRef.current;\n        setStageDimensions({\n          width: clientWidth,\n          height: clientHeight\n        });\n      }\n    };\n    window.addEventListener('resize', handleResize);\n    handleResize();\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      socket.off('connect');\n      socket.off('disconnect');\n      socket.off('whiteboardState');\n      socket.off('drawingStarted');\n      socket.off('drawing');\n      socket.off('drawingFinished');\n      socket.off('objectUpdated');\n      socket.off('whiteboardCleared');\n      socket.off('chatMessage');\n      socket.off('userJoined');\n      socket.off('roomDestroyed');\n    };\n  }, [roomName, navigate]);\n  useEffect(() => {\n    var _chatMessagesEndRef$c;\n    (_chatMessagesEndRef$c = chatMessagesEndRef.current) === null || _chatMessagesEndRef$c === void 0 ? void 0 : _chatMessagesEndRef$c.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [chatMessages]);\n  const handleObjectChange = useCallback(updatedObject => {\n    setDrawingObjects(prevObjects => {\n      return prevObjects.map(obj => {\n        if (obj.id === updatedObject.id) {\n          return updatedObject;\n        }\n        return obj;\n      });\n    });\n    socket.emit('updateObject', {\n      roomName,\n      objectId: updatedObject.id,\n      newAttributes: updatedObject\n    });\n  }, [roomName]);\n\n  // Re-added e.evt.preventDefault() for touch events\n  const handleMouseDown = e => {\n    const clickedOnEmpty = e.target === e.target.getStage();\n    if (tool === 'select' && clickedOnEmpty) {\n      selectShape(null);\n      return;\n    }\n    // THIS IS THE KEY FIX FOR TOUCHSCREENS\n    if (e.evt.type === 'touchstart') {\n      e.evt.preventDefault();\n    }\n    setIsDrawing(true);\n    const pos = e.target.getStage().getPointerPosition();\n    const newObjectId = `${socket.id}-${Date.now()}`;\n    currentObjectId.current = newObjectId;\n    selectShape(null);\n    let newObject;\n    // --- LOGIC FOR DIFFERENT BRUSH TYPES ---\n    switch (tool) {\n      case 'pen':\n      case 'marker':\n      case 'dashed':\n      case 'calligraphy':\n      case 'eraser':\n        let currentStrokeColor = tool === 'eraser' ? '#FFFFFF' : strokeColor;\n        let currentStrokeWidth = tool === 'eraser' ? strokeWidth + 10 : strokeWidth;\n        let currentOpacity = tool === 'eraser' ? 1.0 : brushOpacity; // Eraser is always opaque\n        let currentLineCap = lineCap;\n        let currentDash = [];\n        if (tool === 'marker') {\n          currentOpacity = 0.6; // Slightly more opaque\n          currentStrokeWidth = Math.max(15, strokeWidth * 2); // Thicker marker\n          currentLineCap = 'butt'; // Flat ends\n        } else if (tool === 'dashed') {\n          currentDash = [10, 10]; // 10px line, 10px gap\n        } else if (tool === 'calligraphy') {\n          currentStrokeWidth = Math.max(8, strokeWidth * 1.5); // Thicker, simulates broader tip\n          currentLineCap = 'square'; // Flat, square tip\n          currentDash = []; // No dash\n        }\n        newObject = {\n          id: newObjectId,\n          type: 'line',\n          points: [pos.x, pos.y],\n          stroke: currentStrokeColor,\n          strokeWidth: currentStrokeWidth,\n          opacity: currentOpacity,\n          lineCap: currentLineCap,\n          dash: currentDash,\n          tool: tool // Keep the original tool for eraser composite operation\n        };\n        break;\n      case 'rect':\n        newObject = {\n          id: newObjectId,\n          type: 'rect',\n          x: pos.x,\n          y: pos.y,\n          width: 0,\n          height: 0,\n          stroke: strokeColor,\n          strokeWidth: strokeWidth,\n          fill: fillColor,\n          opacity: brushOpacity\n        };\n        break;\n      case 'circle':\n        newObject = {\n          id: newObjectId,\n          type: 'circle',\n          x: pos.x,\n          y: pos.y,\n          radius: 0,\n          stroke: strokeColor,\n          strokeWidth: strokeWidth,\n          fill: fillColor,\n          opacity: brushOpacity\n        };\n        break;\n      case 'text':\n        newObject = {\n          id: newObjectId,\n          type: 'text',\n          x: pos.x,\n          y: pos.y,\n          text: 'Double click to edit',\n          fontSize: 20,\n          fontFamily: 'Arial',\n          stroke: strokeColor,\n          fill: strokeColor,\n          width: 200,\n          height: 30,\n          rotation: 0,\n          opacity: brushOpacity\n        };\n        setIsDrawing(false);\n        socket.emit('startDrawing', {\n          roomName,\n          object: newObject\n        });\n        setDrawingObjects(prevObjects => [...prevObjects, newObject]);\n        selectShape(newObjectId);\n        return;\n      case 'select':\n        setIsDrawing(false);\n        return;\n      default:\n        return;\n    }\n    setDrawingObjects(prevObjects => [...prevObjects, newObject]);\n    socket.emit('startDrawing', {\n      roomName,\n      object: newObject\n    });\n  };\n\n  // Re-added e.evt.preventDefault() for touch events\n  const handleMouseMove = e => {\n    if (!isDrawing) {\n      return;\n    }\n    // THIS IS THE KEY FIX FOR TOUCHSCREENS\n    if (e.evt.type === 'touchmove') {\n      e.evt.preventDefault();\n    }\n    const stage = e.target.getStage();\n    const point = stage.getPointerPosition();\n    let currentObject = drawingObjects.find(obj => obj.id === currentObjectId.current);\n    if (currentObject) {\n      const newObjects = [...drawingObjects];\n      const index = newObjects.findIndex(obj => obj.id === currentObject.id);\n      switch (currentObject.type) {\n        case 'line':\n          currentObject.points = currentObject.points.concat([point.x, point.y]);\n          newObjects[index] = currentObject;\n          setDrawingObjects(newObjects);\n          // Only send new points for lines\n          socket.emit('drawing', {\n            roomName,\n            objectId: currentObjectId.current,\n            newPoints: [point.x, point.y]\n          });\n          break;\n        case 'rect':\n          const newX_rect = Math.min(currentObject.x, point.x);\n          const newY_rect = Math.min(currentObject.y, point.y);\n          const newWidth_rect = Math.abs(point.x - currentObject.x);\n          const newHeight_rect = Math.abs(point.y - currentObject.y);\n          currentObject = {\n            ...currentObject,\n            x: newX_rect,\n            y: newY_rect,\n            width: newWidth_rect,\n            height: newHeight_rect\n          };\n          newObjects[index] = currentObject;\n          setDrawingObjects(newObjects);\n          socket.emit('updateObject', {\n            roomName,\n            objectId: currentObjectId.current,\n            newAttributes: {\n              x: newX_rect,\n              y: newY_rect,\n              width: newWidth_rect,\n              height: newHeight_rect\n            }\n          });\n          break;\n        case 'circle':\n          const newRadius_circle = Math.sqrt(Math.pow(point.x - currentObject.x, 2) + Math.pow(point.y - currentObject.y, 2));\n          currentObject = {\n            ...currentObject,\n            radius: newRadius_circle\n          };\n          newObjects[index] = currentObject;\n          setDrawingObjects(newObjects);\n          socket.emit('updateObject', {\n            roomName,\n            objectId: currentObjectId.current,\n            newAttributes: {\n              radius: newRadius_circle\n            }\n          });\n          break;\n        default:\n          break;\n      }\n    }\n  };\n  const handleMouseUp = () => {\n    setIsDrawing(false);\n    if (tool !== 'select' && tool !== 'text') {\n      const finalObject = drawingObjects.find(obj => obj.id === currentObjectId.current);\n      if (finalObject) {\n        socket.emit('endDrawing', {\n          roomName,\n          objectId: currentObjectId.current,\n          finalObjectState: finalObject\n        });\n      }\n    }\n    currentObjectId.current = null;\n  };\n  const handleSendChatMessage = () => {\n    if (newChatMessage.trim()) {\n      socket.emit('chatMessage', {\n        roomName,\n        message: newChatMessage.trim()\n      });\n      setNewChatMessage('');\n    }\n  };\n  const handleChatKeyPress = e => {\n    if (e.key === 'Enter') {\n      handleSendChatMessage();\n    }\n  };\n  const handleClearWhiteboard = () => {\n    if (window.confirm('Are you sure you want to clear the entire whiteboard? This cannot be undone!')) {\n      socket.emit('clearWhiteboard', roomName);\n    }\n  };\n  const handleCloseRoom = () => {\n    if (window.confirm('Are you sure you want to close this room? All users will be disconnected and data will be deleted.')) {\n      socket.emit('closeRoom', roomName);\n      navigate('/');\n      alert('Room closure initiated.');\n    }\n  };\n  const getCursorStyle = () => {\n    switch (tool) {\n      case 'pen':\n      case 'eraser':\n      case 'rect':\n      case 'circle':\n      case 'marker':\n      case 'dashed':\n      case 'calligraphy':\n        return 'crosshair';\n      case 'text':\n        return 'text';\n      case 'select':\n        return selectedId ? 'move' : 'default';\n      default:\n        return 'default';\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"whiteboard-page-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"whiteboard-main-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: [\"Whiteboard Room: \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"room-name\",\n            children: roomName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 381,\n            columnNumber: 32\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => navigate('/'),\n          className: \"leave-button\",\n          children: \"Leave Room\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tool-palette\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-group tool-group-single\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'select' ? 'active' : ''}`,\n            onClick: () => {\n              setTool('select');\n              selectShape(null);\n            },\n            title: \"Select & Move\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 393,\n              columnNumber: 15\n            }, this), \" Select\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 391,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-separator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 397,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'pen' ? 'active' : ''}`,\n            onClick: () => setTool('pen'),\n            title: \"Pen\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 15\n            }, this), \" Pen\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'marker' ? 'active' : ''}`,\n            onClick: () => setTool('marker'),\n            title: \"Marker\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 15\n            }, this), \" Marker\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'dashed' ? 'active' : ''}`,\n            onClick: () => setTool('dashed'),\n            title: \"Dashed Line\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 15\n            }, this), \" Dashed\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'calligraphy' ? 'active' : ''}`,\n            onClick: () => setTool('calligraphy'),\n            title: \"Calligraphy Pen\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 411,\n              columnNumber: 15\n            }, this), \" Calligraphy\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 410,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-separator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'rect' ? 'active' : ''}`,\n            onClick: () => setTool('rect'),\n            title: \"Rectangle\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 420,\n              columnNumber: 15\n            }, this), \" Rectangle\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'circle' ? 'active' : ''}`,\n            onClick: () => setTool('circle'),\n            title: \"Circle\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 423,\n              columnNumber: 15\n            }, this), \" Circle\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 422,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'text' ? 'active' : ''}`,\n            onClick: () => setTool('text'),\n            title: \"Text\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 426,\n              columnNumber: 15\n            }, this), \" Text\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-separator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-group tool-group-properties\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tool-property-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"stroke-color-picker\",\n              className: \"tool-label\",\n              children: \"Stroke:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 435,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"color\",\n              id: \"stroke-color-picker\",\n              className: \"color-picker\",\n              value: strokeColor,\n              onChange: e => {\n                setStrokeColor(e.target.value);\n                if (tool !== 'eraser' && !['rect', 'circle', 'text'].includes(tool)) setTool('pen');\n              },\n              title: \"Stroke Color\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 434,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tool-property-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"fill-color-picker\",\n              className: \"tool-label\",\n              children: \"Fill:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 440,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"color\",\n              id: \"fill-color-picker\",\n              className: \"color-picker\",\n              value: fillColor,\n              onChange: e => {\n                setFillColor(e.target.value);\n                if (['pen', 'marker', 'dashed', 'calligraphy', 'eraser'].includes(tool)) {\n                  setTool('rect');\n                }\n              },\n              title: \"Fill Color\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 441,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 439,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tool-property-item tool-slider-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"stroke-width-slider\",\n              className: \"tool-label\",\n              children: \"Width:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              id: \"stroke-width-slider\",\n              min: \"1\",\n              max: \"20\",\n              value: strokeWidth,\n              onChange: e => setStrokeWidth(parseInt(e.target.value, 10)),\n              className: \"stroke-width-slider\",\n              title: `Stroke Width: ${strokeWidth}px`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 446,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"stroke-width-display\",\n              children: [strokeWidth, \"px\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 447,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 13\n          }, this), tool !== 'eraser' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tool-property-item tool-slider-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"brush-opacity-slider\",\n              className: \"tool-label\",\n              children: \"Opacity:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 452,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              id: \"brush-opacity-slider\",\n              min: \"0.1\",\n              max: \"1.0\",\n              step: \"0.05\",\n              value: brushOpacity,\n              onChange: e => setBrushOpacity(parseFloat(e.target.value)),\n              className: \"stroke-width-slider\",\n              title: `Opacity: ${Math.round(brushOpacity * 100)}%`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 453,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"stroke-width-display\",\n              children: [Math.round(brushOpacity * 100), \"%\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 454,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 15\n          }, this), ['pen', 'marker', 'dashed', 'calligraphy'].includes(tool) && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tool-property-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"line-cap-select\",\n              className: \"tool-label\",\n              children: \"Cap:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 460,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              id: \"line-cap-select\",\n              value: lineCap,\n              onChange: e => setLineCap(e.target.value),\n              className: \"tool-select\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"round\",\n                children: \"Round\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"butt\",\n                children: \"Butt\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 463,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"square\",\n                children: \"Square\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 464,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 461,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 459,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-separator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `tool-button ${tool === 'eraser' ? 'active' : ''}`,\n            onClick: () => setTool('eraser'),\n            title: \"Eraser\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 475,\n              columnNumber: 15\n            }, this), \" Eraser\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 474,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"tool-button\",\n            onClick: handleClearWhiteboard,\n            title: \"Clear All\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 15\n            }, this), \" Clear All\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"tool-button danger-button\",\n            onClick: handleCloseRoom,\n            title: \"Close & Delete Room\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 481,\n              columnNumber: 15\n            }, this), \" Close Room\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 480,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 473,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"whiteboard-canvas-container\",\n        ref: canvasContainerRef,\n        children: /*#__PURE__*/_jsxDEV(Stage, {\n          width: stageDimensions.width,\n          height: stageDimensions.height,\n          onMouseDown: handleMouseDown,\n          onMousemove: handleMouseMove,\n          onMouseup: handleMouseUp,\n          onTouchStart: handleMouseDown,\n          onTouchMove: handleMouseMove,\n          onTouchEnd: handleMouseUp,\n          ref: stageRef,\n          style: {\n            cursor: getCursorStyle(),\n            backgroundColor: 'white',\n            touchAction: 'none'\n          },\n          children: /*#__PURE__*/_jsxDEV(Layer, {\n            children: drawingObjects.map(obj => {\n              if (obj.type === 'line') {\n                return /*#__PURE__*/_jsxDEV(Line, {\n                  points: obj.points,\n                  stroke: obj.stroke,\n                  strokeWidth: obj.strokeWidth,\n                  opacity: obj.opacity || 1.0,\n                  lineCap: obj.lineCap || 'round',\n                  lineJoin: \"round\",\n                  dash: obj.dash || [],\n                  tension: 0.5,\n                  globalCompositeOperation: obj.tool === 'eraser' ? 'destination-out' : 'source-over'\n                }, obj.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 503,\n                  columnNumber: 21\n                }, this);\n              } else {\n                return /*#__PURE__*/_jsxDEV(ColoredRect, {\n                  shapeProps: obj,\n                  isSelected: obj.id === selectedId,\n                  onSelect: () => {\n                    selectShape(obj.id);\n                    setTool('select');\n                  },\n                  onChange: handleObjectChange,\n                  activeTool: tool\n                }, obj.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 518,\n                  columnNumber: 21\n                }, this);\n              }\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 499,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"hint-text margin-top-md\",\n        children: \"Use the tools above to draw and collaborate!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 528,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Room Chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 532,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-messages\",\n        children: [chatMessages.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-message\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"chat-username\",\n            children: [msg.username, \":\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 536,\n            columnNumber: 15\n          }, this), \" \", msg.message, /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"chat-timestamp\",\n            children: new Date(msg.timestamp).toLocaleTimeString([], {\n              hour: '2-digit',\n              minute: '2-digit'\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 15\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: chatMessagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 540,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 533,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-input-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Type your message...\",\n          value: newChatMessage,\n          onChange: e => setNewChatMessage(e.target.value),\n          onKeyPress: handleChatKeyPress,\n          className: \"chat-input\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 543,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSendChatMessage,\n          className: \"send-button\",\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 542,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 531,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 378,\n    columnNumber: 5\n  }, this);\n}\n_s2(WhiteboardRoom, \"obs0CC+MSzraLkWnb5ybeQlXIAE=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c2 = WhiteboardRoom;\nexport default WhiteboardRoom;\nvar _c, _c2;\n$RefreshReg$(_c, \"ColoredRect\");\n$RefreshReg$(_c2, \"WhiteboardRoom\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","Stage","Layer","Line","Rect","Circle","Text","Transformer","useParams","useNavigate","io","jsxDEV","_jsxDEV","Fragment","_Fragment","socket","ColoredRect","shapeProps","isSelected","onSelect","onChange","activeTool","_s","shapeRef","trRef","current","nodes","getLayer","batchDraw","type","handleDblClick","e","setTimeout","textNode","hide","textPosition","absolutePosition","stageBox","getStage","container","getBoundingClientRect","textarea","document","createElement","body","appendChild","value","text","style","position","top","y","left","x","width","padding","height","fontSize","border","margin","overflow","background","outline","resize","lineHeight","fontFamily","transformOrigin","textAlign","align","color","fill","transform","rotation","zIndex","focus","removeTextarea","removeChild","show","addEventListener","key","shiftKey","blur","currentKonvaNode","onClick","onTap","onDblClick","onDblTap","ref","draggable","onDragEnd","target","onTransformEnd","node","scaleX","scaleY","Math","max","fileName","_jsxFileName","lineNumber","columnNumber","radius","children","boundBoxFunc","oldBox","newBox","_c","WhiteboardRoom","_s2","roomName","navigate","drawingObjects","setDrawingObjects","isDrawing","setIsDrawing","stageRef","currentObjectId","chatMessages","setChatMessages","newChatMessage","setNewChatMessage","chatMessagesEndRef","stageDimensions","setStageDimensions","window","innerWidth","innerHeight","canvasContainerRef","tool","setTool","strokeColor","setStrokeColor","strokeWidth","setStrokeWidth","fillColor","setFillColor","selectedId","selectShape","brushOpacity","setBrushOpacity","lineCap","setLineCap","isDashed","setIsDashed","emit","on","console","log","id","alert","data","lines","messages","newObject","prevObjects","objectId","newPoints","map","obj","points","concat","finalObjectState","newAttributes","message","prevMessages","username","timestamp","Date","destroyedRoomName","handleResize","clientWidth","clientHeight","removeEventListener","off","_chatMessagesEndRef$c","scrollIntoView","behavior","handleObjectChange","updatedObject","handleMouseDown","clickedOnEmpty","evt","preventDefault","pos","getPointerPosition","newObjectId","now","currentStrokeColor","currentStrokeWidth","currentOpacity","currentLineCap","currentDash","stroke","opacity","dash","object","handleMouseMove","stage","point","currentObject","find","newObjects","index","findIndex","newX_rect","min","newY_rect","newWidth_rect","abs","newHeight_rect","newRadius_circle","sqrt","pow","handleMouseUp","finalObject","handleSendChatMessage","trim","handleChatKeyPress","handleClearWhiteboard","confirm","handleCloseRoom","getCursorStyle","className","title","htmlFor","includes","parseInt","step","parseFloat","round","onMouseDown","onMousemove","onMouseup","onTouchStart","onTouchMove","onTouchEnd","cursor","backgroundColor","touchAction","lineJoin","tension","globalCompositeOperation","msg","toLocaleTimeString","hour","minute","placeholder","onKeyPress","_c2","$RefreshReg$"],"sources":["C:/Users/gamin/OneDrive/Desktop/Project/Whiteboard/live-whiteboard-app/whiteboard-frontend/src/components/WhiteboardRoom.js"],"sourcesContent":["// whiteboard-frontend/src/components/WhiteboardRoom.js\r\n\r\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Stage, Layer, Line, Rect, Circle, Text, Transformer } from 'react-konva';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { io } from 'socket.io-client';\r\nimport './WhiteboardRoom.css'; // Make sure this CSS file is updated too!\r\n\r\n// IMPORTANT: Make sure YOUR_PC_IP_ADDRESS is replaced with your actual PC's IP.\r\n// Consider using an environment variable for deployment (e.g., process.env.REACT_APP_BACKEND_URL)\r\nconst socket = io('http://192.168.1.102:5000');\r\n\r\n// Helper component for selectable/transformable Konva nodes (unchanged, as touch-action is on Stage)\r\nconst ColoredRect = ({ shapeProps, isSelected, onSelect, onChange, activeTool }) => {\r\n  const shapeRef = useRef();\r\n  const trRef = useRef();\r\n  useEffect(() => {\r\n    if (isSelected && trRef.current && shapeRef.current) { trRef.current.nodes([shapeRef.current]); trRef.current.getLayer().batchDraw(); } else if (!isSelected && trRef.current) { trRef.current.nodes([]); trRef.current.getLayer().batchDraw(); }\r\n  }, [isSelected, shapeProps.type]);\r\n  const handleDblClick = (e) => {\r\n    onSelect();\r\n    if (shapeProps.type === 'text') {\r\n      setTimeout(() => {\r\n        if (trRef.current) { trRef.current.nodes([]); trRef.current.getLayer().batchDraw(); }\r\n        const textNode = shapeRef.current; if (!textNode) return;\r\n        textNode.hide(); textNode.getLayer().batchDraw();\r\n        const textPosition = textNode.absolutePosition();\r\n        const stageBox = textNode.getStage().container().getBoundingClientRect();\r\n        const textarea = document.createElement('textarea'); document.body.appendChild(textarea);\r\n        textarea.value = textNode.text(); textarea.style.position = 'absolute';\r\n        textarea.style.top = (textPosition.y + stageBox.top) + 'px'; textarea.style.left = (textPosition.x + stageBox.left) + 'px';\r\n        textarea.style.width = textNode.width() - textNode.padding() * 2 + 'px'; textarea.style.height = textNode.height() - textNode.padding() * 2 + 5 + 'px';\r\n        textarea.style.fontSize = textNode.fontSize() + 'px'; textarea.style.border = 'none';\r\n        textarea.style.padding = '0px'; textarea.style.margin = '0px'; textarea.style.overflow = 'hidden';\r\n        textarea.style.background = 'none'; textarea.style.outline = 'none'; textarea.style.resize = 'none';\r\n        textarea.style.lineHeight = textNode.lineHeight(); textarea.style.fontFamily = textNode.fontFamily();\r\n        textarea.style.transformOrigin = 'left top'; textarea.style.textAlign = textNode.align();\r\n        textarea.style.color = textNode.fill(); textarea.style.transform = `rotateZ(${textNode.rotation()}deg)`;\r\n        textarea.style.zIndex = '9999';\r\n        textarea.focus();\r\n        const removeTextarea = () => { document.body.removeChild(textarea); textNode.show(); textNode.getLayer().batchDraw(); };\r\n        textarea.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { textarea.blur(); } if (e.key === 'Escape') { removeTextarea(); } });\r\n        textarea.addEventListener('blur', () => { onChange({ ...shapeProps, text: textarea.value, }); removeTextarea(); });\r\n      }, 0);\r\n    }\r\n  };\r\n  const currentKonvaNode = (\r\n    shapeProps.type === 'rect' ? (\r\n      <Rect\r\n        onClick={onSelect} onTap={onSelect} onDblClick={handleDblClick} onDblTap={handleDblClick}\r\n        ref={shapeRef} {...shapeProps} draggable={activeTool === 'select'}\r\n        onDragEnd={(e) => { onChange({ ...shapeProps, x: e.target.x(), y: e.target.y(), }); }}\r\n        onTransformEnd={(e) => {\r\n          const node = shapeRef.current; const scaleX = node.scaleX(); const scaleY = node.scaleY();\r\n          node.scaleX(1); node.scaleY(1);\r\n          onChange({ ...shapeProps, x: node.x(), y: node.y(), width: Math.max(5, node.width() * scaleX), height: Math.max(5, node.height() * scaleY), rotation: node.rotation(), });\r\n        }} />\r\n    ) : shapeProps.type === 'circle' ? (\r\n      <Circle\r\n        onClick={onSelect} onTap={onSelect} onDblClick={handleDblClick} onDblTap={handleDblClick}\r\n        ref={shapeRef} {...shapeProps} draggable={activeTool === 'select'}\r\n        onDragEnd={(e) => { onChange({ ...shapeProps, x: e.target.x(), y: e.target.y(), }); }}\r\n        onTransformEnd={(e) => {\r\n          const node = shapeRef.current; const scaleX = node.scaleX(); node.scaleX(1); node.scaleY(1);\r\n          onChange({ ...shapeProps, x: node.x(), y: node.y(), radius: Math.max(5, node.radius() * scaleX), rotation: node.rotation(), });\r\n        }} />\r\n    ) : shapeProps.type === 'text' ? (\r\n      <Text\r\n        onClick={onSelect} onTap={onSelect} onDblClick={handleDblClick} onDblTap={handleDblClick}\r\n        ref={shapeRef} {...shapeProps} draggable={activeTool === 'select'}\r\n        onDragEnd={(e) => { onChange({ ...shapeProps, x: e.target.x(), y: e.target.y(), }); }}\r\n        onTransformEnd={(e) => {\r\n          const node = shapeRef.current; const scaleX = node.scaleX(); const scaleY = node.scaleY();\r\n          node.scaleX(1); node.scaleY(1);\r\n          onChange({ ...shapeProps, x: node.x(), y: node.y(), width: Math.max(5, node.width() * scaleX), height: Math.max(5, node.height() * scaleY), fontSize: Math.max(8, node.fontSize() * scaleX), rotation: node.rotation(), });\r\n        }} />\r\n    ) : null\r\n  );\r\n  return (\r\n    <>\r\n      {currentKonvaNode}\r\n      {isSelected && currentKonvaNode && (\r\n        <Transformer ref={trRef} boundBoxFunc={(oldBox, newBox) => { if (newBox.width < 5 || newBox.height < 5) { return oldBox; } return newBox; }} />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nfunction WhiteboardRoom() {\r\n  const { roomName } = useParams();\r\n  const navigate = useNavigate();\r\n  const [drawingObjects, setDrawingObjects] = useState([]);\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const stageRef = useRef(null);\r\n  const currentObjectId = useRef(null);\r\n\r\n  const [chatMessages, setChatMessages] = useState([]);\r\n  const [newChatMessage, setNewChatMessage] = useState('');\r\n  const chatMessagesEndRef = useRef(null);\r\n\r\n  const [stageDimensions, setStageDimensions] = useState({\r\n    width: window.innerWidth * 0.7,\r\n    height: window.innerHeight * 0.8\r\n  });\r\n  const canvasContainerRef = useRef(null);\r\n\r\n  // --- BRUSH STATE VARIABLES ---\r\n  const [tool, setTool] = useState('pen'); // 'pen', 'marker', 'dashed', 'calligraphy', 'eraser', 'rect', 'circle', 'text', 'select'\r\n  const [strokeColor, setStrokeColor] = useState('#000000');\r\n  const [strokeWidth, setStrokeWidth] = useState(5);\r\n  const [fillColor, setFillColor] = useState('transparent');\r\n  const [selectedId, selectShape] = useState(null);\r\n\r\n  // Brush specific properties\r\n  const [brushOpacity, setBrushOpacity] = useState(1.0); // 0.0 to 1.0\r\n  const [lineCap, setLineCap] = useState('round'); // 'butt', 'round', 'square'\r\n  const [isDashed, setIsDashed] = useState(false); // Whether the line should be dashed (now controlled by tool directly)\r\n\r\n  useEffect(() => {\r\n    if (!roomName) {\r\n      navigate('/');\r\n      return;\r\n    }\r\n\r\n    socket.emit('joinRoom', roomName);\r\n\r\n    socket.on('connect', () => {\r\n      console.log('Connected to backend Socket.IO:', socket.id);\r\n    });\r\n\r\n    socket.on('disconnect', () => {\r\n      console.log('Disconnected from backend Socket.IO');\r\n      alert('Disconnected from server. Please refresh.');\r\n      navigate('/');\r\n    });\r\n\r\n    socket.on('whiteboardState', (data) => {\r\n      console.log('Received initial room state:', data);\r\n      setDrawingObjects(data.lines);\r\n      setChatMessages(data.messages);\r\n    });\r\n\r\n    socket.on('drawingStarted', (newObject) => {\r\n        setDrawingObjects((prevObjects) => [...prevObjects, newObject]);\r\n    });\r\n\r\n    socket.on('drawing', (data) => {\r\n        const { objectId, newPoints } = data;\r\n        setDrawingObjects((prevObjects) => {\r\n            return prevObjects.map((obj) => {\r\n                if (obj.id === objectId && obj.type === 'line') {\r\n                    return { ...obj, points: obj.points.concat(newPoints) };\r\n                }\r\n                return obj;\r\n            });\r\n        });\r\n    });\r\n\r\n    socket.on('drawingFinished', (data) => {\r\n        const { objectId, finalObjectState } = data;\r\n        setDrawingObjects((prevObjects) => {\r\n            return prevObjects.map((obj) => {\r\n                if (obj.id === objectId) {\r\n                    return finalObjectState;\r\n                }\r\n                return obj;\r\n            });\r\n        });\r\n    });\r\n\r\n    socket.on('objectUpdated', (data) => {\r\n        const { objectId, newAttributes } = data;\r\n        setDrawingObjects((prevObjects) => {\r\n            return prevObjects.map((obj) => {\r\n                if (obj.id === objectId) {\r\n                    return { ...obj, ...newAttributes };\r\n                }\r\n                return obj;\r\n            });\r\n        });\r\n    });\r\n\r\n    socket.on('whiteboardCleared', () => {\r\n        setDrawingObjects([]);\r\n        selectShape(null);\r\n        console.log('Whiteboard cleared by another user.');\r\n    });\r\n\r\n    socket.on('chatMessage', (message) => {\r\n        setChatMessages((prevMessages) => [...prevMessages, message]);\r\n    });\r\n\r\n    socket.on('userJoined', (username) => {\r\n        setChatMessages((prevMessages) => [...prevMessages, {\r\n            username: 'System',\r\n            message: `${username} has joined the room.`,\r\n            timestamp: new Date()\r\n        }]);\r\n    });\r\n\r\n    socket.on('roomDestroyed', (destroyedRoomName) => {\r\n        if (destroyedRoomName === roomName) {\r\n            alert(`Room \"${destroyedRoomName}\" has been closed or automatically destroyed.`);\r\n            navigate('/');\r\n        }\r\n    });\r\n\r\n    const handleResize = () => {\r\n      if (canvasContainerRef.current) {\r\n        const { clientWidth, clientHeight } = canvasContainerRef.current;\r\n        setStageDimensions({ width: clientWidth, height: clientHeight });\r\n      }\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    handleResize();\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize);\r\n      socket.off('connect');\r\n      socket.off('disconnect');\r\n      socket.off('whiteboardState');\r\n      socket.off('drawingStarted');\r\n      socket.off('drawing');\r\n      socket.off('drawingFinished');\r\n      socket.off('objectUpdated');\r\n      socket.off('whiteboardCleared');\r\n      socket.off('chatMessage');\r\n      socket.off('userJoined');\r\n      socket.off('roomDestroyed');\r\n    };\r\n  }, [roomName, navigate]);\r\n\r\n  useEffect(() => {\r\n    chatMessagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [chatMessages]);\r\n\r\n  const handleObjectChange = useCallback((updatedObject) => {\r\n    setDrawingObjects((prevObjects) => {\r\n      return prevObjects.map((obj) => {\r\n        if (obj.id === updatedObject.id) {\r\n          return updatedObject;\r\n        }\r\n        return obj;\r\n      });\r\n    });\r\n    socket.emit('updateObject', { roomName, objectId: updatedObject.id, newAttributes: updatedObject });\r\n  }, [roomName]);\r\n\r\n  // Re-added e.evt.preventDefault() for touch events\r\n  const handleMouseDown = (e) => {\r\n    const clickedOnEmpty = e.target === e.target.getStage();\r\n    if (tool === 'select' && clickedOnEmpty) {\r\n      selectShape(null);\r\n      return;\r\n    }\r\n    // THIS IS THE KEY FIX FOR TOUCHSCREENS\r\n    if (e.evt.type === 'touchstart') {\r\n        e.evt.preventDefault();\r\n    }\r\n    setIsDrawing(true);\r\n    const pos = e.target.getStage().getPointerPosition();\r\n    const newObjectId = `${socket.id}-${Date.now()}`;\r\n    currentObjectId.current = newObjectId;\r\n    selectShape(null);\r\n\r\n    let newObject;\r\n    // --- LOGIC FOR DIFFERENT BRUSH TYPES ---\r\n    switch (tool) {\r\n      case 'pen':\r\n      case 'marker':\r\n      case 'dashed':\r\n      case 'calligraphy':\r\n      case 'eraser':\r\n        let currentStrokeColor = tool === 'eraser' ? '#FFFFFF' : strokeColor;\r\n        let currentStrokeWidth = tool === 'eraser' ? strokeWidth + 10 : strokeWidth;\r\n        let currentOpacity = tool === 'eraser' ? 1.0 : brushOpacity; // Eraser is always opaque\r\n        let currentLineCap = lineCap;\r\n        let currentDash = [];\r\n\r\n        if (tool === 'marker') {\r\n          currentOpacity = 0.6; // Slightly more opaque\r\n          currentStrokeWidth = Math.max(15, strokeWidth * 2); // Thicker marker\r\n          currentLineCap = 'butt'; // Flat ends\r\n        } else if (tool === 'dashed') {\r\n          currentDash = [10, 10]; // 10px line, 10px gap\r\n        } else if (tool === 'calligraphy') {\r\n          currentStrokeWidth = Math.max(8, strokeWidth * 1.5); // Thicker, simulates broader tip\r\n          currentLineCap = 'square'; // Flat, square tip\r\n          currentDash = []; // No dash\r\n        }\r\n\r\n        newObject = {\r\n          id: newObjectId,\r\n          type: 'line',\r\n          points: [pos.x, pos.y],\r\n          stroke: currentStrokeColor,\r\n          strokeWidth: currentStrokeWidth,\r\n          opacity: currentOpacity,\r\n          lineCap: currentLineCap,\r\n          dash: currentDash,\r\n          tool: tool // Keep the original tool for eraser composite operation\r\n        };\r\n        break;\r\n      case 'rect':\r\n        newObject = { id: newObjectId, type: 'rect', x: pos.x, y: pos.y, width: 0, height: 0, stroke: strokeColor, strokeWidth: strokeWidth, fill: fillColor, opacity: brushOpacity };\r\n        break;\r\n      case 'circle':\r\n        newObject = { id: newObjectId, type: 'circle', x: pos.x, y: pos.y, radius: 0, stroke: strokeColor, strokeWidth: strokeWidth, fill: fillColor, opacity: brushOpacity };\r\n        break;\r\n      case 'text':\r\n        newObject = { id: newObjectId, type: 'text', x: pos.x, y: pos.y, text: 'Double click to edit', fontSize: 20, fontFamily: 'Arial', stroke: strokeColor, fill: strokeColor, width: 200, height: 30, rotation: 0, opacity: brushOpacity };\r\n        setIsDrawing(false); socket.emit('startDrawing', { roomName, object: newObject }); setDrawingObjects((prevObjects) => [...prevObjects, newObject]); selectShape(newObjectId); return;\r\n      case 'select': setIsDrawing(false); return;\r\n      default: return;\r\n    }\r\n    setDrawingObjects((prevObjects) => [...prevObjects, newObject]);\r\n    socket.emit('startDrawing', { roomName, object: newObject });\r\n  };\r\n\r\n  // Re-added e.evt.preventDefault() for touch events\r\n  const handleMouseMove = (e) => {\r\n    if (!isDrawing) { return; }\r\n    // THIS IS THE KEY FIX FOR TOUCHSCREENS\r\n    if (e.evt.type === 'touchmove') {\r\n        e.evt.preventDefault();\r\n    }\r\n    const stage = e.target.getStage(); const point = stage.getPointerPosition();\r\n    let currentObject = drawingObjects.find(obj => obj.id === currentObjectId.current);\r\n\r\n    if (currentObject) {\r\n      const newObjects = [...drawingObjects]; const index = newObjects.findIndex(obj => obj.id === currentObject.id);\r\n      switch (currentObject.type) {\r\n        case 'line':\r\n          currentObject.points = currentObject.points.concat([point.x, point.y]);\r\n          newObjects[index] = currentObject;\r\n          setDrawingObjects(newObjects);\r\n          // Only send new points for lines\r\n          socket.emit('drawing', { roomName, objectId: currentObjectId.current, newPoints: [point.x, point.y] });\r\n          break;\r\n        case 'rect':\r\n          const newX_rect = Math.min(currentObject.x, point.x); const newY_rect = Math.min(currentObject.y, point.y);\r\n          const newWidth_rect = Math.abs(point.x - currentObject.x); const newHeight_rect = Math.abs(point.y - currentObject.y);\r\n          currentObject = { ...currentObject, x: newX_rect, y: newY_rect, width: newWidth_rect, height: newHeight_rect }; newObjects[index] = currentObject; setDrawingObjects(newObjects); socket.emit('updateObject', { roomName, objectId: currentObjectId.current, newAttributes: { x: newX_rect, y: newY_rect, width: newWidth_rect, height: newHeight_rect } }); break;\r\n        case 'circle':\r\n          const newRadius_circle = Math.sqrt(Math.pow(point.x - currentObject.x, 2) + Math.pow(point.y - currentObject.y, 2));\r\n          currentObject = { ...currentObject, radius: newRadius_circle }; newObjects[index] = currentObject; setDrawingObjects(newObjects); socket.emit('updateObject', { roomName, objectId: currentObjectId.current, newAttributes: { radius: newRadius_circle } }); break;\r\n        default: break;\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    setIsDrawing(false);\r\n    if (tool !== 'select' && tool !== 'text') {\r\n      const finalObject = drawingObjects.find(obj => obj.id === currentObjectId.current);\r\n      if (finalObject) { socket.emit('endDrawing', { roomName, objectId: currentObjectId.current, finalObjectState: finalObject }); }\r\n    }\r\n    currentObjectId.current = null;\r\n  };\r\n\r\n  const handleSendChatMessage = () => {\r\n    if (newChatMessage.trim()) { socket.emit('chatMessage', { roomName, message: newChatMessage.trim() }); setNewChatMessage(''); }\r\n  };\r\n  const handleChatKeyPress = (e) => { if (e.key === 'Enter') { handleSendChatMessage(); } };\r\n  const handleClearWhiteboard = () => { if (window.confirm('Are you sure you want to clear the entire whiteboard? This cannot be undone!')) { socket.emit('clearWhiteboard', roomName); } };\r\n  const handleCloseRoom = () => { if (window.confirm('Are you sure you want to close this room? All users will be disconnected and data will be deleted.')) { socket.emit('closeRoom', roomName); navigate('/'); alert('Room closure initiated.'); } };\r\n\r\n  const getCursorStyle = () => {\r\n    switch (tool) {\r\n      case 'pen': case 'eraser': case 'rect': case 'circle': case 'marker': case 'dashed': case 'calligraphy': return 'crosshair';\r\n      case 'text': return 'text'; case 'select': return selectedId ? 'move' : 'default';\r\n      default: return 'default';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"whiteboard-page-container\">\r\n      <div className=\"whiteboard-main-content\">\r\n        <div className=\"header\">\r\n          <h1>Whiteboard Room: <span className=\"room-name\">{roomName}</span></h1>\r\n          <button onClick={() => navigate('/')} className=\"leave-button\">\r\n            Leave Room\r\n          </button>\r\n        </div>\r\n\r\n        {/* --- PROFESSIONAL TOOL PALETTE START --- */}\r\n        <div className=\"tool-palette\">\r\n\r\n          {/* Selection Tool */}\r\n          <div className=\"tool-group tool-group-single\">\r\n            <button className={`tool-button ${tool === 'select' ? 'active' : ''}`} onClick={() => { setTool('select'); selectShape(null); }} title=\"Select & Move\">\r\n              <span className=\"icon\"></span> Select\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"tool-separator\"></div>\r\n\r\n          {/* Brush Tools Group */}\r\n          <div className=\"tool-group\">\r\n            <button className={`tool-button ${tool === 'pen' ? 'active' : ''}`} onClick={() => setTool('pen')} title=\"Pen\">\r\n              <span className=\"icon\"></span> Pen\r\n            </button>\r\n            <button className={`tool-button ${tool === 'marker' ? 'active' : ''}`} onClick={() => setTool('marker')} title=\"Marker\">\r\n              <span className=\"icon\"></span> Marker\r\n            </button>\r\n            <button className={`tool-button ${tool === 'dashed' ? 'active' : ''}`} onClick={() => setTool('dashed')} title=\"Dashed Line\">\r\n              <span className=\"icon\"></span> Dashed\r\n            </button>\r\n            <button className={`tool-button ${tool === 'calligraphy' ? 'active' : ''}`} onClick={() => setTool('calligraphy')} title=\"Calligraphy Pen\">\r\n              <span className=\"icon\"></span> Calligraphy\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"tool-separator\"></div>\r\n\r\n          {/* Shape Tools Group */}\r\n          <div className=\"tool-group\">\r\n            <button className={`tool-button ${tool === 'rect' ? 'active' : ''}`} onClick={() => setTool('rect')} title=\"Rectangle\">\r\n              <span className=\"icon\"></span> Rectangle\r\n            </button>\r\n            <button className={`tool-button ${tool === 'circle' ? 'active' : ''}`} onClick={() => setTool('circle')} title=\"Circle\">\r\n              <span className=\"icon\"></span> Circle\r\n            </button>\r\n            <button className={`tool-button ${tool === 'text' ? 'active' : ''}`} onClick={() => setTool('text')} title=\"Text\">\r\n              <span className=\"icon\"></span> Text\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"tool-separator\"></div>\r\n\r\n          {/* Drawing Properties Group (Color, Width, Opacity, Line Cap) */}\r\n          <div className=\"tool-group tool-group-properties\">\r\n            <div className=\"tool-property-item\">\r\n              <label htmlFor=\"stroke-color-picker\" className=\"tool-label\">Stroke:</label>\r\n              <input type=\"color\" id=\"stroke-color-picker\" className=\"color-picker\" value={strokeColor} onChange={(e) => { setStrokeColor(e.target.value); if (tool !== 'eraser' && !['rect', 'circle', 'text'].includes(tool)) setTool('pen'); }} title=\"Stroke Color\" />\r\n            </div>\r\n\r\n            <div className=\"tool-property-item\">\r\n              <label htmlFor=\"fill-color-picker\" className=\"tool-label\">Fill:</label>\r\n              <input type=\"color\" id=\"fill-color-picker\" className=\"color-picker\" value={fillColor} onChange={(e) => { setFillColor(e.target.value); if (['pen', 'marker', 'dashed', 'calligraphy', 'eraser'].includes(tool)) { setTool('rect'); } }} title=\"Fill Color\" />\r\n            </div>\r\n\r\n            <div className=\"tool-property-item tool-slider-item\">\r\n              <label htmlFor=\"stroke-width-slider\" className=\"tool-label\">Width:</label>\r\n              <input type=\"range\" id=\"stroke-width-slider\" min=\"1\" max=\"20\" value={strokeWidth} onChange={(e) => setStrokeWidth(parseInt(e.target.value, 10))} className=\"stroke-width-slider\" title={`Stroke Width: ${strokeWidth}px`} />\r\n              <span className=\"stroke-width-display\">{strokeWidth}px</span>\r\n            </div>\r\n\r\n            {tool !== 'eraser' && (\r\n              <div className=\"tool-property-item tool-slider-item\">\r\n                <label htmlFor=\"brush-opacity-slider\" className=\"tool-label\">Opacity:</label>\r\n                <input type=\"range\" id=\"brush-opacity-slider\" min=\"0.1\" max=\"1.0\" step=\"0.05\" value={brushOpacity} onChange={(e) => setBrushOpacity(parseFloat(e.target.value))} className=\"stroke-width-slider\" title={`Opacity: ${Math.round(brushOpacity * 100)}%`} />\r\n                <span className=\"stroke-width-display\">{Math.round(brushOpacity * 100)}%</span>\r\n              </div>\r\n            )}\r\n\r\n            {['pen', 'marker', 'dashed', 'calligraphy'].includes(tool) && (\r\n              <div className=\"tool-property-item\">\r\n                <label htmlFor=\"line-cap-select\" className=\"tool-label\">Cap:</label>\r\n                <select id=\"line-cap-select\" value={lineCap} onChange={(e) => setLineCap(e.target.value)} className=\"tool-select\">\r\n                  <option value=\"round\">Round</option>\r\n                  <option value=\"butt\">Butt</option>\r\n                  <option value=\"square\">Square</option>\r\n                </select>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"tool-separator\"></div>\r\n\r\n          {/* Action Buttons Group */}\r\n          <div className=\"tool-group\">\r\n            <button className={`tool-button ${tool === 'eraser' ? 'active' : ''}`} onClick={() => setTool('eraser')} title=\"Eraser\">\r\n              <span className=\"icon\"></span> Eraser\r\n            </button>\r\n            <button className=\"tool-button\" onClick={handleClearWhiteboard} title=\"Clear All\">\r\n              <span className=\"icon\"></span> Clear All\r\n            </button>\r\n            <button className=\"tool-button danger-button\" onClick={handleCloseRoom} title=\"Close & Delete Room\">\r\n              <span className=\"icon\"></span> Close Room\r\n            </button>\r\n          </div>\r\n        </div>\r\n        {/* --- PROFESSIONAL TOOL PALETTE END --- */}\r\n\r\n        <div className=\"whiteboard-canvas-container\" ref={canvasContainerRef}>\r\n          <Stage\r\n            width={stageDimensions.width} height={stageDimensions.height}\r\n            onMouseDown={handleMouseDown} onMousemove={handleMouseMove} onMouseup={handleMouseUp}\r\n            onTouchStart={handleMouseDown} onTouchMove={handleMouseMove} onTouchEnd={handleMouseUp}\r\n            ref={stageRef}\r\n            style={{\r\n                cursor: getCursorStyle(),\r\n                backgroundColor: 'white',\r\n                touchAction: 'none'\r\n            }}\r\n          >\r\n            <Layer>\r\n              {drawingObjects.map((obj) => {\r\n                if (obj.type === 'line') {\r\n                  return (\r\n                    <Line\r\n                      key={obj.id}\r\n                      points={obj.points}\r\n                      stroke={obj.stroke}\r\n                      strokeWidth={obj.strokeWidth}\r\n                      opacity={obj.opacity || 1.0}\r\n                      lineCap={obj.lineCap || 'round'}\r\n                      lineJoin=\"round\"\r\n                      dash={obj.dash || []}\r\n                      tension={0.5}\r\n                      globalCompositeOperation={obj.tool === 'eraser' ? 'destination-out' : 'source-over'}\r\n                    />\r\n                  );\r\n                } else {\r\n                  return (\r\n                    <ColoredRect\r\n                      key={obj.id} shapeProps={obj} isSelected={obj.id === selectedId}\r\n                      onSelect={() => { selectShape(obj.id); setTool('select'); }}\r\n                      onChange={handleObjectChange} activeTool={tool} />\r\n                  );\r\n                }\r\n              })}\r\n            </Layer>\r\n          </Stage>\r\n        </div>\r\n        <p className=\"hint-text margin-top-md\">Use the tools above to draw and collaborate!</p>\r\n      </div>\r\n\r\n      <div className=\"chat-sidebar\">\r\n        <h2>Room Chat</h2>\r\n        <div className=\"chat-messages\">\r\n          {chatMessages.map((msg, index) => (\r\n            <div key={index} className=\"chat-message\">\r\n              <span className=\"chat-username\">{msg.username}:</span> {msg.message}\r\n              <span className=\"chat-timestamp\">{new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\r\n            </div>\r\n          ))}\r\n          <div ref={chatMessagesEndRef} />\r\n        </div>\r\n        <div className=\"chat-input-group\">\r\n          <input type=\"text\" placeholder=\"Type your message...\" value={newChatMessage} onChange={(e) => setNewChatMessage(e.target.value)} onKeyPress={handleChatKeyPress} className=\"chat-input\" />\r\n          <button onClick={handleSendChatMessage} className=\"send-button\">Send</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default WhiteboardRoom;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}